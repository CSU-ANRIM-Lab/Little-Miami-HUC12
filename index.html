<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="./resources/ol.css">
        <link rel="stylesheet" href="resources/fontawesome-all.min.css">
        <link rel="stylesheet" type="text/css" href="resources/horsey.min.css">
        <link rel="stylesheet" type="text/css" href="resources/ol3-search-layer.min.css">
        <link rel="stylesheet" href="./resources/ol-layerswitcher.css">
        <link rel="stylesheet" href="./resources/qgis2web.css">
        <style>
            html, body {
                background-color: #ffffff;
            }
            .ol-control button {
                background-color: #c5dbea !important;
                color: #444444 !important;
                border-radius: 0px;
            }
            .ol-zoom, .gcd-gl-control .ol-zoom {
                background-color: rgba(255,255,255,.4) !important;
                padding: 3px !important;
            }
            .ol-scale-line {
                background: none !important;
            }
            .ol-scale-line-inner {
                border: 2px solid #c5dbea !important;
                border-top: none !important;
                background: rgba(255, 255, 255, 0.5) !important;
                color: black !important;
            }
            .ol-attribution a, .gcd-gl-input::placeholder, .search-layer-input-search::placeholder {
                color: #444444 !important;
            }
            .search-layer-input-search {
                background-color: #c5dbea !important;
            }
            #map-title-search-container {
                position: absolute;
                top: 10px;
                left: 50%;
                transform: translateX(-50%);
                z-index: 1000;
                text-align: center;
                background-color: rgba(255, 255, 255, 0.7);
                padding: 10px;
                border-radius: 4px;
            }
            #map-title {
                font-size: 18px;
                font-weight: bold;
                margin-bottom: 10px;
            }
            #search-container {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            #search-input {
                padding: 5px;
                font-size: 14px;
                border: 1px solid #ccc;
                border-radius: 4px 0 0 4px;
                width: 200px;
            }
            #search-button {
                padding: 5px 10px;
                background-color: #c5dbea;
                color: #444444;
                border: 1px solid #ccc;
                border-left: none;
                border-radius: 0 4px 4px 0;
                cursor: pointer;
                font-size: 14px;
            }
            #search-button:hover {
                background-color: #b1cfe0;
            }
            #search-result {
                margin-top: 5px;
                color: #444444;
                font-size: 12px;
            }
            html, body, #map {
                width: 100%;
                height: 100%;
                padding: 0;
                margin: 0;
            }
        </style>
        <title></title>
    </head>
    <body>
        <div id="map">
            <div id="popup" class="ol-popup">
                <a href="#" id="popup-closer" class="ol-popup-closer"></a>
                <div id="popup-content"></div>
            </div>
        </div>
        <div id="map-title-search-container">
            <div id="map-title">Great Miami and Little Miami Watersheds -- ACPF Modeling</div>
            <div id="search-container">
                <input type="text" id="search-input" placeholder="Search HUC12">
                <button id="search-button">Search</button>
            </div>
            <div id="search-result"></div>
        </div>
        <script src="resources/qgis2web_expressions.js"></script>
        <script src="resources/polyfills.js"></script>
        <script src="./resources/functions.js"></script>
        <script src="./resources/ol.js"></script>
        <script src="./resources/ol-layerswitcher.js"></script>
        <script src="layers/SWOhioHUC12_1.js"></script>
        <script src="layers/GMandLMHUC8Boundary_2.js"></script>
        <script src="styles/SWOhioHUC12_1_style.js"></script>
        <script src="styles/GMandLMHUC8Boundary_2_style.js"></script>
        <script src="./layers/layers.js" type="text/javascript"></script>
        <script src="./resources/Autolinker.min.js"></script>
        <script src="./resources/qgis2web.js"></script>
        <script>
        var map = new ol.Map({
            target: 'map',
            layers: [
                new ol.layer.Group({
                    'title': '',
                    layers: [
                        lyr_SWOhioHUC12_1,
                        lyr_GMandLMHUC8Boundary_2,
                    ]
                })
            ],
            view: new ol.View({
                center: ol.proj.fromLonLat([-84.5, 39.5]),
                zoom: 8
            })
        });

        var pinLayer = new ol.layer.Vector({
            source: new ol.source.Vector(),
            style: new ol.style.Style({
                image: new ol.style.Circle({
                    radius: 6,
                    fill: new ol.style.Fill({color: 'red'}),
                    stroke: new ol.style.Stroke({color: 'white', width: 2})
                })
            })
        });

        map.addLayer(pinLayer);

        var highlightedFeature = null;

        function removeHighlight() {
            if (highlightedFeature) {
                highlightedFeature.setStyle(null);
                highlightedFeature = null;
                pinLayer.getSource().clear();
                document.getElementById('search-result').innerText = "";
            }
        }

        function searchHUC12() {
            var searchValue = document.getElementById('search-input').value.trim();
            var found = false;

            removeHighlight();

            lyr_SWOhioHUC12_1.getSource().getFeatures().forEach(function (feature) {
                if (feature.get('HUC12') === searchValue) {
                    found = true;
                    
                    var extent = feature.getGeometry().getExtent();
                    var center = ol.extent.getCenter(extent);

                    map.getView().fit(extent, {duration: 1000, padding: [50, 50, 50, 50]});

                    var pinFeature = new ol.Feature({
                        geometry: new ol.geom.Point(center)
                    });
                    pinLayer.getSource().addFeature(pinFeature);

                    feature.setStyle(new ol.style.Style({
                        stroke: new ol.style.Stroke({
                            color: 'red',
                            width: 3
                        }),
                        fill: new ol.style.Fill({
                            color: 'rgba(255, 0, 0, 0.1)'
                        })
                    }));

                    highlightedFeature = feature;
                }
            });

            if (!found) {
                document.getElementById('search-result').innerText = "HUC12 not found.";
            } else {
                document.getElementById('search-result').innerText = "HUC12 found and highlighted. Click on it to remove highlight.";
            }
        }

        document.getElementById('search-input').addEventListener('keyup', function (event) {
            if (event.key === 'Enter') {
                searchHUC12();
            }
        });

        document.getElementById('search-button').addEventListener('click', searchHUC12);

        map.on('click', function(evt) {
            var feature = map.forEachFeatureAtPixel(evt.pixel, function(feature) {
                return feature;
            });

            if (feature === highlightedFeature) {
                removeHighlight();
            }
        });
        </script>
    </body>
</html>
