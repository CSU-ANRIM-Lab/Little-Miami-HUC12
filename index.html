<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HUC12 Map</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.5.0/css/ol.css">
    <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.5.0/build/ol.js"></script>
    <style>
        #map {
            width: 100%;
            height: 100vh;
        }
        #search-container {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 5px;
        }
        #search-input {
            width: 200px;
            padding: 5px;
        }
        #search-button {
            padding: 5px 10px;
        }
        #search-result {
            margin-top: 5px;
            font-weight: bold;
        }
    </style>
    <meta name="apple-mobile-web-app-capable" content="yes">
</head>
<body>
    <div id="map"></div>
    <div id="search-container">
        <input type="text" id="search-input" placeholder="Enter HUC12">
        <button id="search-button">Search</button>
        <div id="search-result"></div>
    </div>
    <script>
        // Initialize the map
        var map = new ol.Map({
            target: 'map',
            layers: [
                new ol.layer.Tile({
                    source: new ol.source.OSM()
                })
            ],
            view: new ol.View({
                center: ol.proj.fromLonLat([-98.5795, 39.8283]),
                zoom: 4
            })
        });

        // HUC12 layer
        var huc12Layer = new ol.layer.Vector({
            source: new ol.source.Vector({
                url: 'path/to/your/huc12_data.geojson',
                format: new ol.format.GeoJSON()
            }),
            style: new ol.style.Style({
                stroke: new ol.style.Stroke({
                    color: 'blue',
                    width: 1
                }),
                fill: new ol.style.Fill({
                    color: 'rgba(0, 0, 255, 0.1)'
                })
            })
        });

        map.addLayer(huc12Layer);

        // Vector layer for the pin
        var pinLayer = new ol.layer.Vector({
            source: new ol.source.Vector(),
            style: new ol.style.Style({
                image: new ol.style.Icon({
                    anchor: [0.5, 1],
                    src: 'path/to/pin-icon.png' // Replace with the path to your pin icon
                })
            })
        });

        // Add pin layer to the map
        map.addLayer(pinLayer);

        // Variable to store the currently highlighted feature
        var highlightedFeature = null;

        // Function to remove highlight
        function removeHighlight() {
            if (highlightedFeature) {
                highlightedFeature.setStyle(null); // Reset to default style
                highlightedFeature = null;
                pinLayer.getSource().clear(); // Remove the pin
                document.getElementById('search-result').innerText = "";
            }
        }

        // Search function
        function searchHUC12() {
            var searchValue = document.getElementById('search-input').value.trim();
            var found = false;

            removeHighlight(); // Remove any existing highlight

            huc12Layer.getSource().getFeatures().forEach(function (feature) {
                if (feature.get('HUC12') === searchValue) {
                    found = true;
                    
                    // Get the extent and center of the feature
                    var extent = feature.getGeometry().getExtent();
                    var center = ol.extent.getCenter(extent);

                    // Zoom to the feature
                    map.getView().fit(extent, { duration: 1000, padding: [50, 50, 50, 50] });

                    // Add a new pin at the center of the feature
                    var pinFeature = new ol.Feature({
                        geometry: new ol.geom.Point(center)
                    });
                    pinLayer.getSource().addFeature(pinFeature);

                    // Highlight the found feature
                    feature.setStyle(new ol.style.Style({
                        stroke: new ol.style.Stroke({
                            color: 'red',
                            width: 3
                        }),
                        fill: new ol.style.Fill({
                            color: 'rgba(255, 0, 0, 0.1)'
                        })
                    }));

                    highlightedFeature = feature; // Store the highlighted feature
                }
            });

            if (!found) {
                document.getElementById('search-result').innerText = "HUC12 is not found.";
            } else {
                document.getElementById('search-result').innerText = "HUC12 found and highlighted. Click on it to remove highlight.";
            }
        }

        // Add event listener for the search input
        document.getElementById('search-input').addEventListener('keyup', function (event) {
            if (event.key === 'Enter') {
                searchHUC12();
            }
        });

        // Add event listener for the search button
        document.getElementById('search-button').addEventListener('click', searchHUC12);

        // Add click event listener to the map
        map.on('click', function(evt) {
            var feature = map.forEachFeatureAtPixel(evt.pixel, function(feature) {
                return feature;
            });

            if (feature === highlightedFeature) {
                removeHighlight();
            }
        });
    </script>
</body>
</html>
